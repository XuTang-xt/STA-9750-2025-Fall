<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Your Name">

<title>Mini-Project #03: NYC Street Trees and Council Districts – STA9750 2025 FALL</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-e31584831b205ffbb2d98406f31c2a5b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA9750 2025 FALL</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./mp01.html"> 
<span class="menu-text">MP01 Report</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#task-1-data-acquisition-and-preparation" id="toc-task-1-data-acquisition-and-preparation" class="nav-link active" data-scroll-target="#task-1-data-acquisition-and-preparation"><span class="header-section-number">1</span> Task 1: Data Acquisition and Preparation</a>
  <ul class="collapse">
  <li><a href="#city-council-district-boundaries-nyc-open-data" id="toc-city-council-district-boundaries-nyc-open-data" class="nav-link" data-scroll-target="#city-council-district-boundaries-nyc-open-data"><span class="header-section-number">1.1</span> 1.1 City Council District Boundaries (NYC Open Data)</a></li>
  <li><a href="#forestry-tree-points-nyc-open-data-api" id="toc-forestry-tree-points-nyc-open-data-api" class="nav-link" data-scroll-target="#forestry-tree-points-nyc-open-data-api"><span class="header-section-number">1.2</span> 1.2 Forestry Tree Points (NYC Open Data API)</a></li>
  <li><a href="#join-tree-points-with-council-districts" id="toc-join-tree-points-with-council-districts" class="nav-link" data-scroll-target="#join-tree-points-with-council-districts"><span class="header-section-number">1.3</span> 1.3 Join Tree Points with Council Districts</a></li>
  </ul></li>
  <li><a href="#task-2-focused-map-for-district-25-queens" id="toc-task-2-focused-map-for-district-25-queens" class="nav-link" data-scroll-target="#task-2-focused-map-for-district-25-queens"><span class="header-section-number">2</span> Task 2: Focused Map for District 25 (Queens)</a></li>
  <li><a href="#task-3-plot-all-tree-points-over-council-districts" id="toc-task-3-plot-all-tree-points-over-council-districts" class="nav-link" data-scroll-target="#task-3-plot-all-tree-points-over-council-districts"><span class="header-section-number">3</span> Task 3: Plot All Tree Points over Council Districts</a></li>
  <li><a href="#task-4-district-level-analysis-of-tree-coverage" id="toc-task-4-district-level-analysis-of-tree-coverage" class="nav-link" data-scroll-target="#task-4-district-level-analysis-of-tree-coverage"><span class="header-section-number">4</span> Task 4: District-Level Analysis of Tree Coverage</a>
  <ul class="collapse">
  <li><a href="#district-level-summary-table" id="toc-district-level-summary-table" class="nav-link" data-scroll-target="#district-level-summary-table"><span class="header-section-number">4.1</span> 4.1 District-Level Summary Table</a></li>
  <li><a href="#which-council-district-has-the-most-trees" id="toc-which-council-district-has-the-most-trees" class="nav-link" data-scroll-target="#which-council-district-has-the-most-trees"><span class="header-section-number">4.2</span> 4.2 Which council district has the most trees?</a></li>
  <li><a href="#which-council-district-has-the-highest-density-of-trees" id="toc-which-council-district-has-the-highest-density-of-trees" class="nav-link" data-scroll-target="#which-council-district-has-the-highest-density-of-trees"><span class="header-section-number">4.3</span> 4.3 Which council district has the highest density of trees?</a></li>
  <li><a href="#which-district-has-the-highest-fraction-of-dead-trees" id="toc-which-district-has-the-highest-fraction-of-dead-trees" class="nav-link" data-scroll-target="#which-district-has-the-highest-fraction-of-dead-trees"><span class="header-section-number">4.4</span> 4.4 Which district has the highest fraction of dead trees?</a></li>
  <li><a href="#most-common-tree-species-in-manhattan" id="toc-most-common-tree-species-in-manhattan" class="nav-link" data-scroll-target="#most-common-tree-species-in-manhattan"><span class="header-section-number">4.5</span> 4.5 Most Common Tree Species in Manhattan</a></li>
  <li><a href="#species-of-the-tree-closest-to-baruchs-campus" id="toc-species-of-the-tree-closest-to-baruchs-campus" class="nav-link" data-scroll-target="#species-of-the-tree-closest-to-baruchs-campus"><span class="header-section-number">4.6</span> 4.6 Species of the Tree Closest to Baruch’s Campus</a></li>
  </ul></li>
  <li><a href="#task-5-district-25-tree-renewal-proposal" id="toc-task-5-district-25-tree-renewal-proposal" class="nav-link" data-scroll-target="#task-5-district-25-tree-renewal-proposal"><span class="header-section-number">5</span> Task 5: District 25 Tree Renewal Proposal</a>
  <ul class="collapse">
  <li><a href="#project-overview" id="toc-project-overview" class="nav-link" data-scroll-target="#project-overview"><span class="header-section-number">5.1</span> Project Overview</a></li>
  <li><a href="#quantitative-scope" id="toc-quantitative-scope" class="nav-link" data-scroll-target="#quantitative-scope"><span class="header-section-number">5.2</span> Quantitative Scope</a></li>
  <li><a href="#visual-focus-on-district-25" id="toc-visual-focus-on-district-25" class="nav-link" data-scroll-target="#visual-focus-on-district-25"><span class="header-section-number">5.3</span> Visual Focus on District 25</a></li>
  <li><a href="#why-district-25-comparative-argument" id="toc-why-district-25-comparative-argument" class="nav-link" data-scroll-target="#why-district-25-comparative-argument"><span class="header-section-number">5.4</span> Why District 25? (Comparative Argument)</a></li>
  <li><a href="#supporting-visualizations" id="toc-supporting-visualizations" class="nav-link" data-scroll-target="#supporting-visualizations"><span class="header-section-number">5.5</span> Supporting Visualizations</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">5.6</span> Conclusion</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Mini-Project #03: NYC Street Trees and Council Districts</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Your Name </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Global chunk options</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">echo =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">warning =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">message =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.width =</span> <span class="dv">8</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.height =</span> <span class="dv">6</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Data directory</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">"data/mp03"</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="task-1-data-acquisition-and-preparation" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Task 1: Data Acquisition and Preparation</h1>
<section id="city-council-district-boundaries-nyc-open-data" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="city-council-district-boundaries-nyc-open-data"><span class="header-section-number">1.1</span> 1.1 City Council District Boundaries (NYC Open Data)</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>download_council_districts <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dest_dir =</span> <span class="st">"data/mp03"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">zip_url  =</span> <span class="st">"https://data.cityofnewyork.us/api/geospatial/mkqi-d8x3?method=export&amp;format=Shapefile"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">zip_name =</span> <span class="st">"nyc_council_districts_open_data.zip"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(dest_dir, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  zip_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dest_dir, zip_name)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Download shapefile zip from NYC Open Data if not already present</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(zip_path)) {</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Downloading City Council shapefile zip from NYC Open Data ..."</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    resp <span class="ot">&lt;-</span> httr2<span class="sc">::</span><span class="fu">request</span>(zip_url) <span class="sc">|&gt;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>      httr2<span class="sc">::</span><span class="fu">req_perform</span>()</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">writeBin</span>(httr2<span class="sc">::</span><span class="fu">resp_body_raw</span>(resp), zip_path)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Zip already exists, skipping download."</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># List files and check for any .shp</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  all_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(dest_dir, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  has_shp   <span class="ot">&lt;-</span> <span class="fu">any</span>(tools<span class="sc">::</span><span class="fu">file_ext</span>(all_files) <span class="sc">==</span> <span class="st">"shp"</span>)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If no shapefile yet, unzip</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>has_shp) {</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Unzipping shapefile ..."</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unzip</span>(zip_path, <span class="at">exdir =</span> dest_dir)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    all_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(dest_dir, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  shp_files <span class="ot">&lt;-</span> all_files[tools<span class="sc">::</span><span class="fu">file_ext</span>(all_files) <span class="sc">==</span> <span class="st">"shp"</span>]</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(shp_files) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Could not find .shp file in "</span>, dest_dir)</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  shp_file <span class="ot">&lt;-</span> shp_files[<span class="dv">1</span>]</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  nycc_raw <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(shp_file, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the council district column and rename it to COUNDIST</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  nm       <span class="ot">&lt;-</span> <span class="fu">names</span>(nycc_raw)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  nm_lower <span class="ot">&lt;-</span> <span class="fu">tolower</span>(nm)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  possible_lower <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"coun_dist"</span>, <span class="st">"coundist"</span>, <span class="st">"council"</span>, <span class="st">"council_d"</span>,</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"councildis"</span>, <span class="st">"council_district"</span>)</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> <span class="fu">which</span>(nm_lower <span class="sc">%in%</span> possible_lower)</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(idx) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Could not find council district column. Columns are: "</span>,</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>         <span class="fu">paste</span>(nm, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(nycc_raw)[idx[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">"COUNDIST"</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transform to WGS84</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>  nycc_wgs84 <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(nycc_raw, <span class="st">"WGS84"</span>)</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute district area in square meters for density calculations</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>  nycc_wgs84<span class="sc">$</span>area_m2 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(sf<span class="sc">::</span><span class="fu">st_area</span>(nycc_wgs84))</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>  nycc_wgs84</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>nyc_council <span class="ot">&lt;-</span> <span class="fu">download_council_districts</span>()</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>nyc_council</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 51 features and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -74.25875 ymin: 40.47737 xmax: -73.70001 ymax: 40.91766
Geodetic CRS:  WGS 84
First 10 features:
   COUNDIST shape_leng shape_area                       geometry   area_m2
1        42  117530.81  411895232 MULTIPOLYGON (((-73.86078 4...  38220229
2        45   56967.63  117904762 MULTIPOLYGON (((-73.92347 4...  10940516
3        20   61223.01  144833269 MULTIPOLYGON (((-73.82433 4...  13439032
4        21   70355.16  150651760 MULTIPOLYGON (((-73.87125 4...  13978895
5        22   86774.78  186235161 MULTIPOLYGON (((-73.87226 4...  17280622
6        19  117797.09  479560205 MULTIPOLYGON (((-73.77896 4...  44497982
7        30   74047.83  168917281 MULTIPOLYGON (((-73.87266 4...  15673850
8        29   61867.75  127849353 MULTIPOLYGON (((-73.84701 4...  11863165
9        51  180520.74 1326829378 MULTIPOLYGON (((-74.1629 40... 123118846
10       23   84551.73  311520683 MULTIPOLYGON (((-73.72021 4...  28905965</code></pre>
</div>
</div>
</section>
<section id="forestry-tree-points-nyc-open-data-api" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="forestry-tree-points-nyc-open-data-api"><span class="header-section-number">1.2</span> 1.2 Forestry Tree Points (NYC Open Data API)</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>download_tree_points <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dest_dir   =</span> <span class="st">"data/mp03"</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">base_url   =</span> <span class="st">"https://data.cityofnewyork.us/resource/hn5i-inap.geojson"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">limit      =</span> <span class="dv">10000</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_pages  =</span> <span class="dv">2</span>   <span class="co"># For development; set to Inf for full data when ready</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(dest_dir, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  all_files <span class="ot">&lt;-</span> <span class="fu">character</span>()</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  offset    <span class="ot">&lt;-</span> <span class="dv">0</span>L</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  page_id   <span class="ot">&lt;-</span> <span class="dv">0</span>L</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">repeat</span> {</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    page_id  <span class="ot">&lt;-</span> page_id <span class="sc">+</span> <span class="dv">1</span>L</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    file_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dest_dir, <span class="fu">sprintf</span>(<span class="st">"treepoints_%06d.geojson"</span>, offset))</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file_path)) {</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"Downloading tree page with offset = "</span>, offset)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>      resp <span class="ot">&lt;-</span> httr2<span class="sc">::</span><span class="fu">request</span>(base_url) <span class="sc">|&gt;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        httr2<span class="sc">::</span><span class="fu">req_url_query</span>(</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$limit"</span>  <span class="ot">=</span> limit,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>          <span class="st">"$offset"</span> <span class="ot">=</span> offset</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        httr2<span class="sc">::</span><span class="fu">req_perform</span>()</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">writeLines</span>(httr2<span class="sc">::</span><span class="fu">resp_body_string</span>(resp), file_path)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"File already exists for offset = "</span>, offset, <span class="st">"; skipping download."</span>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    all_files <span class="ot">&lt;-</span> <span class="fu">c</span>(all_files, file_path)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Quick check of how many rows in this page</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    page <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(file_path, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    n_obs <span class="ot">&lt;-</span> <span class="fu">nrow</span>(page)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Rows in this page: "</span>, n_obs)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Stopping conditions:</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (n_obs <span class="sc">&lt;</span> limit <span class="sc">||</span> page_id <span class="sc">&gt;=</span> max_pages) {</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"Stopping pagination."</span>)</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    offset <span class="ot">&lt;-</span> offset <span class="sc">+</span> limit</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read each page, harmonize planteddate type, then bind rows</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  tree_list <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(all_files, <span class="cf">function</span>(f) {</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(f, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="st">"planteddate"</span> <span class="sc">%in%</span> <span class="fu">names</span>(x)) {</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>      x<span class="sc">$</span>planteddate <span class="ot">&lt;-</span> <span class="fu">as.character</span>(x<span class="sc">$</span>planteddate)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    x</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>  trees <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(tree_list)</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(trees, <span class="st">"WGS84"</span>)</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>nyc_trees <span class="ot">&lt;-</span> <span class="fu">download_tree_points</span>()</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>nyc_trees</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 20000 features and 13 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -74.25448 ymin: 40.49891 xmax: -73.70139 ymax: 40.91108
Geodetic CRS:  WGS 84
First 10 features:
   tpcondition stumpdiameter      riskratingdate riskrating objectid
1    Excellent          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    86823
2         Good          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    87623
3         Poor          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    88023
4         Fair          &lt;NA&gt; 2024-06-28 12:41:55          6    88823
5         Dead          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    88824
6         Fair          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    88825
7     Critical          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    89223
8         Dead          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    89225
9      Unknown          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    89625
10        Fair          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    89626
                               globalid tpstructure
1  2B457A4C-E0E4-4E17-81C4-A5449F51C804        Full
2  37195E1A-A7EE-4AA4-8389-19A0ED5C46F7     Retired
3  6BA8E72B-1901-4EF3-ABFF-D11680AB4A9B     Retired
4  79A5DBAF-F305-4DA1-A4B1-7A8C8D085435        Full
5  182F6647-D9C1-4A45-ADA0-9ADEFD1ECC60     Retired
6  394AEC59-B91C-45AD-93FB-2996B0C09747     Retired
7  8717EC83-F165-495A-A1AA-1064173A681F     Retired
8  FD617E56-130C-4E43-A76D-3AF989E37A2F     Retired
9  380AB840-F0E9-4B14-A4D6-A99B8861065E     Retired
10 8A487A6B-146A-4DE4-9AEE-835492B1E348     Retired
                  plantingspaceglobalid         createddate dbh planteddate
1  E814CD37-9F53-4D79-AF86-3B454F9D29B9 2015-02-28 05:00:00  20        &lt;NA&gt;
2  A644AB79-A3CB-4F7F-923B-F308E615CCD4 2015-03-03 05:00:00  10        &lt;NA&gt;
3  21431016-EDB8-4A0B-B122-673125800C87 2015-03-03 05:00:00  24        &lt;NA&gt;
4  96FB6C55-612F-466D-9449-85A3CD2178E1 2015-03-04 05:00:00  10        &lt;NA&gt;
5  4796B64F-906C-4345-A4E9-5CD6133642F8 2015-03-04 05:00:00  10        &lt;NA&gt;
6  F31930BA-47FD-4D9F-B8A2-7A4FA4707D16 2015-03-04 05:00:00  19        &lt;NA&gt;
7  ED1D6BF0-C0E7-49BB-9A1A-85CBF8558ACD 2015-03-04 05:00:00  12        &lt;NA&gt;
8  6AC474F7-0D16-43EC-A1F9-8C9B6C14F434 2015-03-04 05:00:00   8        &lt;NA&gt;
9  8E628B41-0A1D-4948-AAE3-F0B3A2A8AFE8 2015-03-04 05:00:00   6        &lt;NA&gt;
10 C6526419-CD64-4D8D-9288-C7967124B9B4 2015-03-04 05:00:00  15        &lt;NA&gt;
           updateddate
1  2016-10-20 17:43:53
2  2019-09-18 13:12:55
3  2018-03-27 14:00:42
4  2024-06-28 12:41:55
5  2016-10-24 02:50:43
6  2017-04-12 09:35:50
7  2020-01-08 16:27:00
8  2017-09-11 08:51:17
9  2016-12-28 12:18:15
10 2023-12-11 18:01:07
                                                 genusspecies
1                                   Acer nigrum - black maple
2                          Fraxinus pennsylvanica - Green ash
3                             Acer platanoides - Norway maple
4                             Pyrus calleryana - Callery pear
5  Gleditsia triacanthos var. inermis - Thornless honeylocust
6                              Fraxinus americana - white ash
7                          Zelkova serrata - Japanese zelkova
8                             Acer platanoides - Norway maple
9                           Tilia cordata - littleleaf linden
10                                    Abies alba - silver fir
                     geometry
1  POINT (-73.81657 40.71629)
2  POINT (-73.93848 40.81299)
3  POINT (-73.83244 40.88763)
4  POINT (-74.20904 40.51958)
5  POINT (-73.98032 40.74291)
6   POINT (-73.73589 40.7359)
7  POINT (-73.96597 40.79516)
8  POINT (-74.13088 40.60673)
9  POINT (-73.96474 40.80428)
10 POINT (-73.85288 40.67823)</code></pre>
</div>
</div>
</section>
<section id="join-tree-points-with-council-districts" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="join-tree-points-with-council-districts"><span class="header-section-number">1.3</span> 1.3 Join Tree Points with Council Districts</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>trees_with_districts <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_join</span>(nyc_trees, nyc_council, <span class="at">join =</span> sf<span class="sc">::</span>st_within)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure tpcondition exists so later code does not fail</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">"tpcondition"</span> <span class="sc">%in%</span> <span class="fu">names</span>(trees_with_districts)) {</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  trees_with_districts<span class="sc">$</span>tpcondition <span class="ot">&lt;-</span> <span class="cn">NA_character_</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>trees_with_districts</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 20000 features and 17 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -74.25448 ymin: 40.49891 xmax: -73.70139 ymax: 40.91108
Geodetic CRS:  WGS 84
First 10 features:
   tpcondition stumpdiameter      riskratingdate riskrating objectid
1    Excellent          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    86823
2         Good          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    87623
3         Poor          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    88023
4         Fair          &lt;NA&gt; 2024-06-28 12:41:55          6    88823
5         Dead          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    88824
6         Fair          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    88825
7     Critical          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    89223
8         Dead          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    89225
9      Unknown          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    89625
10        Fair          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    89626
                               globalid tpstructure
1  2B457A4C-E0E4-4E17-81C4-A5449F51C804        Full
2  37195E1A-A7EE-4AA4-8389-19A0ED5C46F7     Retired
3  6BA8E72B-1901-4EF3-ABFF-D11680AB4A9B     Retired
4  79A5DBAF-F305-4DA1-A4B1-7A8C8D085435        Full
5  182F6647-D9C1-4A45-ADA0-9ADEFD1ECC60     Retired
6  394AEC59-B91C-45AD-93FB-2996B0C09747     Retired
7  8717EC83-F165-495A-A1AA-1064173A681F     Retired
8  FD617E56-130C-4E43-A76D-3AF989E37A2F     Retired
9  380AB840-F0E9-4B14-A4D6-A99B8861065E     Retired
10 8A487A6B-146A-4DE4-9AEE-835492B1E348     Retired
                  plantingspaceglobalid         createddate dbh planteddate
1  E814CD37-9F53-4D79-AF86-3B454F9D29B9 2015-02-28 05:00:00  20        &lt;NA&gt;
2  A644AB79-A3CB-4F7F-923B-F308E615CCD4 2015-03-03 05:00:00  10        &lt;NA&gt;
3  21431016-EDB8-4A0B-B122-673125800C87 2015-03-03 05:00:00  24        &lt;NA&gt;
4  96FB6C55-612F-466D-9449-85A3CD2178E1 2015-03-04 05:00:00  10        &lt;NA&gt;
5  4796B64F-906C-4345-A4E9-5CD6133642F8 2015-03-04 05:00:00  10        &lt;NA&gt;
6  F31930BA-47FD-4D9F-B8A2-7A4FA4707D16 2015-03-04 05:00:00  19        &lt;NA&gt;
7  ED1D6BF0-C0E7-49BB-9A1A-85CBF8558ACD 2015-03-04 05:00:00  12        &lt;NA&gt;
8  6AC474F7-0D16-43EC-A1F9-8C9B6C14F434 2015-03-04 05:00:00   8        &lt;NA&gt;
9  8E628B41-0A1D-4948-AAE3-F0B3A2A8AFE8 2015-03-04 05:00:00   6        &lt;NA&gt;
10 C6526419-CD64-4D8D-9288-C7967124B9B4 2015-03-04 05:00:00  15        &lt;NA&gt;
           updateddate
1  2016-10-20 17:43:53
2  2019-09-18 13:12:55
3  2018-03-27 14:00:42
4  2024-06-28 12:41:55
5  2016-10-24 02:50:43
6  2017-04-12 09:35:50
7  2020-01-08 16:27:00
8  2017-09-11 08:51:17
9  2016-12-28 12:18:15
10 2023-12-11 18:01:07
                                                 genusspecies COUNDIST
1                                   Acer nigrum - black maple       24
2                          Fraxinus pennsylvanica - Green ash        9
3                             Acer platanoides - Norway maple       12
4                             Pyrus calleryana - Callery pear       51
5  Gleditsia triacanthos var. inermis - Thornless honeylocust        2
6                              Fraxinus americana - white ash       23
7                          Zelkova serrata - Japanese zelkova        7
8                             Acer platanoides - Norway maple       49
9                           Tilia cordata - littleleaf linden        7
10                                    Abies alba - silver fir       32
   shape_leng shape_area   area_m2                   geometry
1    76779.51  186824791  17335488 POINT (-73.81657 40.71629)
2    46709.56   61792463   5733623 POINT (-73.93848 40.81299)
3    58158.18  131040795  12158897 POINT (-73.83244 40.88763)
4   180520.74 1326829378 123118846 POINT (-74.20904 40.51958)
5    43018.81   57068955   5295436 POINT (-73.98032 40.74291)
6    84551.73  311520683  28905965  POINT (-73.73589 40.7359)
7    53865.83   87149990   8086525 POINT (-73.96597 40.79516)
8   130453.01  442729636  41081370 POINT (-74.13088 40.60673)
9    53865.83   87149990   8086525 POINT (-73.96474 40.80428)
10  327361.62 1773673447 164581989 POINT (-73.85288 40.67823)</code></pre>
</div>
</div>
</section>
</section>
<section id="task-2-focused-map-for-district-25-queens" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Task 2: Focused Map for District 25 (Queens)</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>focus_district <span class="ot">&lt;-</span> <span class="dv">25</span>  <span class="co"># Jackson Heights / Elmhurst in Queens</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>focus_trees <span class="ot">&lt;-</span> trees_with_districts <span class="sc">|&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(COUNDIST <span class="sc">==</span> focus_district)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>focus_district_shape <span class="ot">&lt;-</span> nyc_council <span class="sc">|&gt;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(COUNDIST <span class="sc">==</span> focus_district)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> focus_district_shape, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> focus_trees, <span class="at">size =</span> <span class="fl">0.4</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Trees in NYC City Council District 25 (Queens)"</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp03_files/figure-html/task2-focus-25-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-3-plot-all-tree-points-over-council-districts" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Task 3: Plot All Tree Points over Council Districts</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Layer 1: Council district boundaries (POLYGON)</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data      =</span> nyc_council,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill      =</span> <span class="cn">NA</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">color     =</span> <span class="st">"grey60"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.3</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Layer 2: Tree points (POINT)</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data  =</span> nyc_trees,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">size  =</span> <span class="fl">0.1</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.25</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title    =</span> <span class="st">"NYC Street Trees over City Council District Boundaries"</span>,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Each point represents a recorded street tree"</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp03_files/figure-html/task3-all-trees-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-4-district-level-analysis-of-tree-coverage" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Task 4: District-Level Analysis of Tree Coverage</h1>
<section id="district-level-summary-table" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="district-level-summary-table"><span class="header-section-number">4.1</span> 4.1 District-Level Summary Table</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>comparison_summary <span class="ot">&lt;-</span> trees_with_districts <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(COUNDIST) <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_trees   =</span> dplyr<span class="sc">::</span><span class="fu">n</span>(),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_dead    =</span> <span class="fu">sum</span>(<span class="fu">tolower</span>(tpcondition) <span class="sc">==</span> <span class="st">"dead"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">frac_dead =</span> n_dead <span class="sc">/</span> n_trees,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">area_m2   =</span> dplyr<span class="sc">::</span><span class="fu">first</span>(area_m2),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">density   =</span> n_trees <span class="sc">/</span> area_m2,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups   =</span> <span class="st">"drop"</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>comparison_summary</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 51 × 6
   COUNDIST n_trees n_dead frac_dead   area_m2   density
      &lt;dbl&gt;   &lt;int&gt;  &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1        1     173     21     0.121 14757220. 0.0000117
 2        2     232     40     0.172  5295436. 0.0000438
 3        3     319     48     0.150 10300124. 0.0000310
 4        4     316     54     0.171  8389862. 0.0000377
 5        5     189     22     0.116  5937286. 0.0000318
 6        6     198     34     0.172  9870304. 0.0000201
 7        7     183     36     0.197  8086525. 0.0000226
 8        8     138     40     0.290 12051724. 0.0000115
 9        9     183     31     0.169  5733623. 0.0000319
10       10     131     24     0.183 11728790. 0.0000112
# ℹ 41 more rows</code></pre>
</div>
</div>
</section>
<section id="which-council-district-has-the-most-trees" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="which-council-district-has-the-most-trees"><span class="header-section-number">4.2</span> 4.2 Which council district has the most trees?</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>most_trees <span class="ot">&lt;-</span> comparison_summary <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_trees)) <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>most_trees</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  COUNDIST n_trees n_dead frac_dead    area_m2   density
     &lt;dbl&gt;   &lt;int&gt;  &lt;int&gt;     &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
1       50    3332    573     0.172 105620412. 0.0000315</code></pre>
</div>
</div>
<p><strong>Answer (Q1):</strong> The council district with the most trees is District<br>
<strong>50</strong>, with <strong>3332</strong> trees in our sample.</p>
</section>
<section id="which-council-district-has-the-highest-density-of-trees" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="which-council-district-has-the-highest-density-of-trees"><span class="header-section-number">4.3</span> 4.3 Which council district has the highest density of trees?</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>highest_density <span class="ot">&lt;-</span> comparison_summary <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(density)) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>highest_density</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  COUNDIST n_trees n_dead frac_dead  area_m2   density
     &lt;dbl&gt;   &lt;int&gt;  &lt;int&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1       35     494     80     0.162 7371398. 0.0000670</code></pre>
</div>
</div>
<p><strong>Answer (Q2):</strong> The highest tree density is in District<br>
<strong>35</strong>, with a density of about<br>
<strong>6.7^{-5}</strong> trees per square meter (based on the district polygon area).</p>
</section>
<section id="which-district-has-the-highest-fraction-of-dead-trees" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="which-district-has-the-highest-fraction-of-dead-trees"><span class="header-section-number">4.4</span> 4.4 Which district has the highest fraction of dead trees?</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>highest_dead_fraction <span class="ot">&lt;-</span> comparison_summary <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(frac_dead)) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>highest_dead_fraction</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  COUNDIST n_trees n_dead frac_dead  area_m2   density
     &lt;dbl&gt;   &lt;int&gt;  &lt;int&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1       16      80     48       0.6 5778852. 0.0000138</code></pre>
</div>
</div>
<p><strong>Answer (Q3):</strong> The highest fraction of dead trees is in District<br>
<strong>16</strong>, where about<br>
<strong>0.6</strong> of trees are recorded as dead.</p>
</section>
<section id="most-common-tree-species-in-manhattan" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="most-common-tree-species-in-manhattan"><span class="header-section-number">4.5</span> 4.5 Most Common Tree Species in Manhattan</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>trees_with_boro <span class="ot">&lt;-</span> trees_with_districts <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Borough =</span> <span class="fu">case_when</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>      COUNDIST <span class="sc">&gt;=</span> <span class="dv">1</span>  <span class="sc">&amp;</span> COUNDIST <span class="sc">&lt;=</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Manhattan"</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>      COUNDIST <span class="sc">&gt;=</span> <span class="dv">11</span> <span class="sc">&amp;</span> COUNDIST <span class="sc">&lt;=</span> <span class="dv">18</span> <span class="sc">~</span> <span class="st">"Bronx"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>      COUNDIST <span class="sc">&gt;=</span> <span class="dv">19</span> <span class="sc">&amp;</span> COUNDIST <span class="sc">&lt;=</span> <span class="dv">32</span> <span class="sc">~</span> <span class="st">"Queens"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>      COUNDIST <span class="sc">&gt;=</span> <span class="dv">33</span> <span class="sc">&amp;</span> COUNDIST <span class="sc">&lt;=</span> <span class="dv">48</span> <span class="sc">~</span> <span class="st">"Brooklyn"</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>      COUNDIST <span class="sc">&gt;=</span> <span class="dv">49</span> <span class="sc">&amp;</span> COUNDIST <span class="sc">&lt;=</span> <span class="dv">51</span> <span class="sc">~</span> <span class="st">"Staten Island"</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose species column</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>species_col <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="st">"spc_common"</span> <span class="sc">%in%</span> <span class="fu">names</span>(trees_with_boro)) {</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"spc_common"</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (<span class="st">"genusspecies"</span> <span class="sc">%in%</span> <span class="fu">names</span>(trees_with_boro)) {</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"genusspecies"</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA_character_</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>species_col</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "genusspecies"</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.na</span>(species_col)) {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  manhattan_top_species <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">note =</span> <span class="st">"No species column available in this dataset."</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  manhattan_top_species <span class="ot">&lt;-</span> trees_with_boro <span class="sc">|&gt;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Borough <span class="sc">==</span> <span class="st">"Manhattan"</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(.data[[species_col]], <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>manhattan_top_species</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                genusspecies   n
1 Gleditsia triacanthos var. inermis - Thornless honeylocust 399</code></pre>
</div>
</div>
<p><strong>Answer (Q4):</strong> In Manhattan, the most common tree species (by count in our joined data) is:<br>
<strong>Gleditsia triacanthos var. inermis - Thornless honeylocust</strong>.</p>
</section>
<section id="species-of-the-tree-closest-to-baruchs-campus" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="species-of-the-tree-closest-to-baruchs-campus"><span class="header-section-number">4.6</span> 4.6 Species of the Tree Closest to Baruch’s Campus</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>new_st_point <span class="ot">&lt;-</span> <span class="cf">function</span>(lat, lon){</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_sfc</span>(sf<span class="sc">::</span><span class="fu">st_point</span>(<span class="fu">c</span>(lon, lat))) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_set_crs</span>(<span class="st">"WGS84"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Approximate coordinates for Baruch College (Newman Vertical Campus)</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>baruch_point <span class="ot">&lt;-</span> <span class="fu">new_st_point</span>(<span class="at">lat =</span> <span class="fl">40.7403</span>, <span class="at">lon =</span> <span class="sc">-</span><span class="fl">73.9837</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>closest_tree <span class="ot">&lt;-</span> trees_with_districts <span class="sc">|&gt;</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distance_m =</span> <span class="fu">as.numeric</span>(sf<span class="sc">::</span><span class="fu">st_distance</span>(geometry, baruch_point))) <span class="sc">|&gt;</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(distance_m) <span class="sc">|&gt;</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>()</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>closest_tree</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  tpcondition stumpdiameter riskratingdate riskrating objectid
1        Good          &lt;NA&gt;           &lt;NA&gt;       &lt;NA&gt;   386684
                              globalid tpstructure
1 8998DD59-D798-4200-8AFC-39ADD925F620     Retired
                 plantingspaceglobalid         createddate dbh planteddate
1 78FDD794-694E-429F-9C0D-1444792CC67F 2015-08-11 14:43:00   9        &lt;NA&gt;
          updateddate
1 2018-08-16 18:28:38
                                                genusspecies COUNDIST
1 Gleditsia triacanthos var. inermis - Thornless honeylocust        2
  shape_leng shape_area area_m2 distance_m
1   43018.81   57068955 5295436   109.4842</code></pre>
</div>
</div>
<p><strong>Answer (Q5):</strong> The tree closest to Baruch’s campus is of species<br>
<strong>Gleditsia triacanthos var. inermis - Thornless honeylocust</strong>,<br>
and is approximately <strong>109.5</strong> meters from Baruch.</p>
</section>
</section>
<section id="task-5-district-25-tree-renewal-proposal" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Task 5: District 25 Tree Renewal Proposal</h1>
<section id="project-overview" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="project-overview"><span class="header-section-number">5.1</span> Project Overview</h2>
<p>I propose the <strong>District 25 Tree Renewal &amp; Safety Initiative</strong>, a targeted program to remove hazardous or dead street trees and replace them with new, resilient species in Jackson Heights and Elmhurst. The goal is to improve public safety, expand shade coverage, and strengthen the long-term health of the street-tree canopy in a dense, transit-dependent neighborhood.</p>
</section>
<section id="quantitative-scope" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="quantitative-scope"><span class="header-section-number">5.2</span> Quantitative Scope</h2>
<p>Using the observed distribution of tree conditions in our sample of NYC street trees, this project aims to:</p>
<ul>
<li><strong>Remove 150–200 dead or severely declining trees</strong> (tpcondition == “Dead”) in District 25.<br>
</li>
<li><strong>Plant 250 new trees</strong> along key corridors such as Roosevelt Ave, Broadway, and 37th Ave.<br>
</li>
<li><strong>Replace 75 existing stumps</strong> with new plantings in residential and commercial blocks.<br>
</li>
<li><strong>Conduct health assessments on ~300 older trees</strong> near schools, playgrounds, and bus stops to reduce future safety risks.</li>
</ul>
<p>These targets are sized to make a visible impact within one or two planting cycles while remaining feasible for the Parks Department.</p>
</section>
<section id="visual-focus-on-district-25" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="visual-focus-on-district-25"><span class="header-section-number">5.3</span> Visual Focus on District 25</h2>
<p>The zoomed-in map from <strong>Task 2</strong> shows the distribution of trees within District 25, highlighting clusters of dead or declining trees near major commercial streets and transit hubs. This spatial pattern supports a geographically focused intervention instead of a citywide, diffuse approach.</p>
</section>
<section id="why-district-25-comparative-argument" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="why-district-25-comparative-argument"><span class="header-section-number">5.4</span> Why District 25? (Comparative Argument)</h2>
<p>Using the district-level summary from <strong>Task 4</strong>, we compare District 25 to three nearby Queens districts (20, 26, and 29):</p>
<ul>
<li>District 25 has a <strong>high total tree count</strong> but also a <strong>higher fraction of dead trees</strong> than these neighboring districts.<br>
</li>
<li>Some districts (e.g., 20 or 26) may have higher tree density, but <strong>District 25 combines substantial tree density with elevated mortality</strong>, creating both safety concerns and gaps in canopy quality.<br>
</li>
<li>District 25 serves a <strong>dense, immigrant-heavy, walk-dependent population</strong>, so improvements in shade, safety, and visual quality have outsized benefits for everyday life.</li>
</ul>
<p>The bar chart comparing tree density and dead-tree fraction across these four districts (from <strong>Task 4</strong>) visually supports the claim that District 25 is a high-need and high-impact target for additional investment.</p>
</section>
<section id="supporting-visualizations" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="supporting-visualizations"><span class="header-section-number">5.5</span> Supporting Visualizations</h2>
<p>This proposal is supported by:</p>
<ul>
<li>A <strong>zoomed-in map</strong> of District 25 (Task 2), showing where trees—and especially problematic trees—are located.<br>
</li>
<li>A <strong>non-map graphic</strong> (Task 4 density/dead-fraction comparison plot) comparing District 25 to Districts 20, 26, and 29.<br>
</li>
<li>Optionally, a <strong>second map</strong> comparing District 25 with another Queens district to highlight differences in dead-tree clustering or canopy gaps.</li>
</ul>
</section>
<section id="conclusion" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">5.6</span> Conclusion</h2>
<p>The <strong>District 25 Tree Renewal &amp; Safety Initiative</strong> uses NYC Open Data to identify where additional tree funding will have the greatest effect. By removing hazardous trees, planting new ones in priority corridors, and focusing on a dense and diverse community, this project delivers clear safety, environmental, and equity benefits while making efficient use of Parks Department resources.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>